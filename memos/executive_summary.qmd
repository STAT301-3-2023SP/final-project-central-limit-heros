---
title: "Queer Coded: Supervised ML to Predict LGBTQ+ Acceptance in American Neighborhoods"
subtitle: "STAT 301-3 Data Science 3 with R - Executive Summary"
author: "Vlad Nevirkovets, Sean Pascoe, Dylan Yan"
date: today
format: 
  html:
    theme: custom.scss
    embed-resources: true
    link-external-newwindow: true
    df-print: paged
    footnotes-hover: true
title-block-banner: images/pride_banner22.png
title-block-banner-color: black
execute:
  echo: false
  warning: false
from: markdown+emoji
editor_options: 
  chunk_output_type: console
---

```{r}
#label: packages+data

library(tidyverse)
library(tidymodels)
tidymodels_prefer()
library(gt)

load("results/predictions/metrics_by_member.rda")
load("results/predictions/ensemble_preds.rda")
```

::: {.column-page-inset}
## Overview 

::: {.callout-tip icon="false"}
## Github Repo Link

<https://github.com/STAT301-3-2023SP/final-project-central-limit-heros>
:::

***Gayborhoods***, or neighborhoods with a high queer population, are hubs of sociocultural development that form important facets of urban life, but have historically alluded accurate classification due to the difficulty to obtain queer metrics. To solve this issue, we used readily available data pertaining to daily life in an area to build a  regression model to predict the degree of LGBTQ+ representation within a neighborhood, adapting a holistic outcome metric from [Jan Diehm](https://data.world/the-pudding/gayborhoods).



## Quotidian Metrics Reliably Predict Gayborhood Index 

Our predictors were taken from the US Census and Open ICPSR, and use ZCTA as a key to gauge the following:

- [housing characteristics](https://data.census.gov/table?q=rent&g=010XX00US$8600000&tid=ACSDP5Y2021.DP04.)
- [demographic information](https://data.census.gov/table?g=010XX00US$8600000&tid=ACSDP5Y2015.DP05.) 
- [transport to work](https://data.census.gov/table?q=commuting&g=010XX00US$8600000&tid=ACSST5Y2021.S0802.)
- [park space](https://doi.org/10.3886/E119803V1.)

Due to strong right skew, we transformed the outcome variable using the Yeo-Johnson transformation. We then ran a LASSO model with a penalty of .01 to select the most relevant predictor variables, resulting in an 80% reduction in predictors. We tuned and fitted a penalized elastic net regression model (with and without partial least squares), random forest, boosted tree, k-nearest neighbors, neural networks, multivariate adaptive regression splines, and cubist ensemble regression. Feature engineering consisted of imputation of missing values using KNN, removal of near zero variance predictors, dummy encoding categorical predictors (except for random forest), and normalization of all predictors. With a test set ***RMSE of 3.3*** on a variable with a 100 point scale, our ensemble model succeeds at predicting LGBTQ+ sociocultural status of American neighborhoods.

```{r}
#| label: rmse-by-member
#| panel: sidebar
rmse_by_member %>% 
  mutate(rmse = round(rmse, digits = 3)) %>% 
  arrange(rmse) %>% 
  gt() %>% 
  tab_header(title = "Ensemble Results") %>%
  cols_label(
    model_name = "Model Name",
    rmse = "RMSE"
  ) %>% 
  cols_width(everything() ~ px(110)) %>% 
  gtExtras::gt_theme_538() %>% 
  gtExtras::gt_highlight_rows(
    rows = 3,
    fill = "rosybrown1",
    bold_target_only = TRUE,
    target_col = model_name
    ) %>% 
  tab_options(table.font.size = 12)
```


## Ensemble Modeling Predicts LGBTQ+ Deficient Areas

:::: {.columns}

::: {.column width="50%"}
Using RMSE as a metric, we found cubist ensemble regression, elastic net regression, and random forest to be the three best performing models. As our final step, we joined the three best performing models into an ensemble. This ensemble proves effective at predicting gayborhood index, especially at lower values, where predictions are closer to the (more prevalent) observations. The ability of our models to predict variance in gayborhood index is also resolved in our ***concordance correlation coefficient of 0.714***

:::

::: {.column width="10%"}
<!-- empty column to create gap -->
:::

::: {.column width="40%"}

```{r}
#| label: preds-v-true
#| panel: fill
ensemble_preds %>%
  ggplot(aes(x = true_gayborhood_index, y = predictions)) +
  geom_abline(slope = 1, color = "rosybrown1", linetype = "dashed") +
  geom_point(alpha = 0.3) +
  coord_obs_pred() +
  theme_minimal() +
  labs(title = "True vs predicted values of Gayborhood index",
       x = "True Gayborhood index",
       y = "Predicted Gayborhood index")
```

:::

::::


:::





